# Frontend Development Guide

This guide covers local development setup for the Diary Angular frontend.

## Prerequisites

- Node.js 20+ and npm
- Backend server running on `http://localhost:8080`

## Quick Start

### 1. Install Dependencies

```bash
cd frontend
npm install
```

### 2. Start Development Server

```bash
npm start
# or
ng serve
```

The application will be available at `http://localhost:4200`

## Development Proxy Configuration

The frontend uses a proxy configuration to avoid CORS issues during development. All API requests are automatically proxied to the backend server.

### Proxy Configuration (`proxy.conf.json`)

```json
{
  "/v1": {
    "target": "http://localhost:8080",
    "secure": false,
    "logLevel": "debug",
    "changeOrigin": true
  },
  "/web": {
    "target": "http://localhost:8080",
    "secure": false,
    "logLevel": "debug",
    "changeOrigin": true
  }
}
```

### How It Works

1. Frontend runs on `http://localhost:4200`
2. Backend runs on `http://localhost:8080`
3. When frontend makes a request to `/v1/items`, the proxy forwards it to `http://localhost:8080/v1/items`
4. No CORS issues because the request appears to come from the same origin

### Request Flow

```
Browser → http://localhost:4200/v1/items
         ↓ (proxied by Angular dev server)
Backend ← http://localhost:8080/v1/items
```

## Changing Backend URL

### Option 1: Update Proxy Configuration (Recommended)

Edit `proxy.conf.json` to point to a different backend:

```json
{
  "/v1": {
    "target": "http://backend.example.com:8080",
    "secure": false,
    "changeOrigin": true
  }
}
```

### Option 2: Use Full URL in Environment

Edit `src/environments/environment.ts`:

```typescript
export const environment = {
  production: false,
  apiUrl: "http://backend.example.com:8080/v1",
};
```

**Note**: This will cause CORS issues unless the backend is configured to allow requests from `http://localhost:4200`.

## Running Backend Locally

### Option 1: Using Make

```bash
# In project root
make run-backend
```

### Option 2: Using Go Directly

```bash
cd backend
GB_USERS=test@test.com:JDJhJDEwJC9sVWJpTlBYVlZvcU9ZNUxIZmhqYi4vUnRuVkJNaEw4MTQ2VUdFSXRDeE9Ib0ZoVkRLR3pl \
GB_DATAPATH=../diary-data \
go run cmd/main.go server
```

### Option 3: Using Docker

```bash
# In project root
docker compose up backend
```

## Development Workflow

### 1. Start Backend

```bash
# Terminal 1
make run-backend
```

### 2. Start Frontend

```bash
# Terminal 2
cd frontend
npm start
```

### 3. Access Application

Open `http://localhost:4200` in your browser.

**Default Credentials:**
- Email: `test@test.com`
- Password: `test`

## Available Scripts

```bash
# Start development server with proxy
npm start

# Build for production
npm run build

# Run tests
npm test

# Run linter
npm run lint

# Watch mode (rebuild on changes)
npm run watch
```

## Proxy Debugging

### Enable Verbose Logging

The proxy is already configured with `"logLevel": "debug"` in `proxy.conf.json`. You'll see proxy requests in the terminal:

```
[HPM] GET /v1/items -> http://localhost:8080
```

### Common Issues

#### Backend Not Running

**Error**: `[HPM] Error occurred while trying to proxy request`

**Solution**: Make sure the backend is running on `http://localhost:8080`

```bash
# Check if backend is running
curl http://localhost:8080/web/about
```

#### Wrong Backend Port

**Error**: Connection refused

**Solution**: Update the `target` in `proxy.conf.json` to match your backend port.

#### CORS Errors Despite Proxy

**Error**: CORS policy error in browser console

**Solution**: Make sure you're accessing the frontend via `http://localhost:4200`, not opening `index.html` directly.

## Production Build

### Build

```bash
npm run build
```

Output will be in `dist/Diary.FE/browser/`

### Test Production Build Locally

```bash
# Install a simple HTTP server
npm install -g http-server

# Serve the production build
cd dist/Diary.FE/browser
http-server -p 8081
```

**Note**: Production build uses runtime configuration from `/assets/config.json`, which is generated by the Docker entrypoint script.

## Environment Files

### Development (`src/environments/environment.ts`)

```typescript
export const environment = {
  production: false,
  apiUrl: "/v1", // Proxied to backend via proxy.conf.json
};
```

### Production (`src/environments/environment.prod.ts`)

```typescript
export const environment = {
  production: true,
  apiUrl: "/v1", // Will be overridden by runtime config from /assets/config.json
};
```

## Runtime Configuration

In production (Docker), the API URL is configured at runtime via the `API_URL` environment variable. See [DOCKER.md](../DOCKER.md) for details.

## Hot Module Replacement (HMR)

Angular dev server supports HMR by default. Changes to TypeScript, HTML, and CSS files will automatically reload in the browser.

## Tips

- Use Chrome DevTools for debugging
- Install Angular DevTools browser extension
- Use `console.log()` sparingly - prefer Angular's built-in debugging tools
- Check the Network tab to see proxied requests
- Use the Angular Language Service in VS Code for better IntelliSense

## Troubleshooting

### Port 4200 Already in Use

```bash
# Kill the process using port 4200
lsof -ti:4200 | xargs kill -9

# Or use a different port
ng serve --port 4201
```

### Node Modules Issues

```bash
# Clear node_modules and reinstall
rm -rf node_modules package-lock.json
npm install
```

### Angular CLI Issues

```bash
# Clear Angular cache
ng cache clean

# Or manually
rm -rf .angular/cache
```

## Additional Resources

- [Angular Documentation](https://angular.dev)
- [Angular CLI Documentation](https://angular.dev/tools/cli)
- [Proxy Configuration](https://angular.dev/tools/cli/serve#proxying-to-a-backend-server)
- [Main README](../README.md)
- [Docker Deployment](../DOCKER.md)

